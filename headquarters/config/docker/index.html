<!doctype html><html lang=en><head><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-129284684-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content><meta name=keywords content="installation,configuration,docker"><link rel=icon href=/img/favicon/favicon-support-1.png type=image/png sizes=16x16><link rel=icon href=/img/favicon/favicon-support-1-48-win-ico.png type=image/png sizes=48x48><link rel=icon href=/img/favicon/favicon-support-1-158-General-use-iOS-Android.png type=image/png sizes=152x152><link rel=icon href=/img/favicon/favicon-support-1-196-Chrome-for-Android.png type=image/png sizes=196x196><link rel=icon href=/img/favicon/favicon-support-1-558-win10-tile.png type=image/png sizes=558x558><title>Deployment with Docker</title><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900&subset=cyrillic,cyrillic-ext,greek,greek-ext,latin-ext,vietnamese" rel=stylesheet><link href=/css/all.css rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.css rel=stylesheet></head><body><header class="px-md-3 pt-3"><div class=container><div class=row><div class="mb-3 col-lg-6 col-md-12"><a class="navbar-brand text-white pr-0 mr-0 float-left" href=https://mysurvey.solutions/ target=_blank><img src=/img/logo.png alt="Survey Solutions" class=float-left>
<span class="float-left ml-2">Survey<br>Solutions</span></a>
<a class="navbar-text text-white pl-sm-4 ml-sm-4 pl-2 ml-2 float-left" href=https://docs.mysurvey.solutions/>Documentation and knowledge base</a></div><script type=text/template id=my-custom-menu-template>
    <div class="aa">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="docs-tab" data-toggle="tab" href="#docs" role="tab" aria-controls="docs" aria-selected="true">Articles</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="forum-tab" data-toggle="tab" href="#forum" role="tab" aria-controls="forum" aria-selected="false">Forum topics</a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="aa-dataset-docs tab-pane fade show active" id="docs" role="tabpanel" aria-labelledby="docs-tab"></div>
            <div class="aa-dataset-forum tab-pane fade" id="forum" role="tabpanel" aria-labelledby="forum-tab"></div>
        </div>
    </div>
</script><div class="col-lg-6 col-md-12 pt-2 mb-4 mb-lg-3"><form class=form-inline onsubmit=return!1><div class="input-group search"><input type=text class="form-control w-100" placeholder="Have a Question? Ask or enter a search term here." id=aa-search-input></div></form></div></div></div></header><main class="container mb-3"><nav aria-label=breadcrumb><ol class="breadcrumb bg-transparent pl-0"><li class=breadcrumb-item><a href=/>Home</a></li><li class=breadcrumb-item><a href=/headquarters/>Headquarters</a></li><li class=breadcrumb-item><a href=/headquarters/config/>Setup and Configuration</a></li><li class="breadcrumb-item active" aria-current=page>Deployment with Docker</li></ol></nav><div class=mb-4><article class="article d-block w-100"><div class="mb-5 pb-1 d-block w-100 page-title d-flex align-items-end"><h2 class="mb-3 mr-auto pr-3">Deployment with Docker</h2><div class="data text-right">November 9, 2020</div></div><div class=article-content><p>You can install and run Survey Solutions Headquarters using our <a href=https://hub.docker.com/r/surveysolutions/surveysolutions>official Docker image</a>.</p><h3 id=prerequisite>Prerequisite</h3><p>Survey Solutions container can be executed on any hosting system that is capable of running linux/amd64 containers.
Please refer to docker documentation page on how to install Docker for Your operating system - <a href=https://docs.docker.com/get-docker>https://docs.docker.com/get-docker</a></p><blockquote><p>Survey Solutions has linux based container image and cannot be run in Windows Containers. To run Survey Solutions in Docker on Windows you will need <a href=https://docs.microsoft.com/en-us/windows/wsl/compare-versions#whats-new-in-wsl-2>WSL2</a></p></blockquote><p>You still need to have <strong>PostgreSQL</strong> server running, there is an <a href=https://hub.docker.com/r/surveysolutions/surveysolutions>example</a> on doing it using docker with docker-compose.</p><h3 id=run-survey-solutions>Run Survey Solutions</h3><blockquote><p>Note: If you are on a Linux system, you might need to add <code>sudo</code> before the commands.</p></blockquote><pre><code class=language-CMD data-lang=CMD>
docker run -p 80:80 --name hq \
    -e &quot;HQ_Headquarters__TenantName=hq&quot; \
    -e &quot;HQ_Headquarters__BaseUrl=http://localhost&quot; \
    -e &quot;HQ_ConnectionStrings__DefaultConnection: 'Persist Security Info=true;Server=db;Port=5432;User Id=postgres;Password=pg_password;Database=SurveySolutions&quot; \
    surveysolutions/surveysolutions:latest
</code></pre><blockquote><p><code>HQ_Headquarters__TenantName</code> is required env variable in this release, this setting will be optional in future
<code>HQ_ConnectionStrings__DefaultConnection</code> Connection String to Postgres instance. For parameters documentation refer to <a href=https://www.npgsql.org/doc/connection-string-parameters.html>documentation</a></p></blockquote><h4 id=volumes>Volumes</h4><p>Survey Solutions has 3 usages of file system that should be persisted: interview binary data (images), asp.net core data protection keys and logs.</p><p>Docker provide quite a lot of options on how to <a href=https://docs.docker.com/storage>handle persitent data</a>. To preserve Survey Solutions data You must map local folder into container or use <a href=https://docs.docker.com/storage/volumes>Docker Volumes</a>.</p><p>When hosting in Docker, aspnet core applications should manage a volume for Data Protection keys: <a href="https://docs.microsoft.com/en-us/aspnet/core/security/data-protection/configuration/overview?view=aspnetcore-3.1#persisting-keys-when-hosting-in-a-docker-containe">https://docs.microsoft.com/en-us/aspnet/core/security/data-protection/configuration/overview?view=aspnetcore-3.1#persisting-keys-when-hosting-in-a-docker-containe</a>.</p><p>Use following volume map to handle: <code>dataprotection:/root/.aspnet/DataProtection-Keys</code>, where <code>dataprotection</code> is a volume name.</p><p>All images uploaded to HQ during interviews are stored in <code>/app/AppData</code> folder.</p><h4 id=using-docker-volumes>Using docker volumes</h4><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker create volume hq_data
docker create volume data_protection

docker run -p 80:80 --name hq <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -e <span style=color:#a31515>&#34;HQ_Headquarters__TenantName=hq&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -e <span style=color:#a31515>&#34;HQ_Headquarters__BaseUrl=http://localhost&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -e <span style=color:#a31515>&#34;HQ_ConnectionStrings__DefaultConnection=Server=db;Port=5432;User Id=postgres;Password=pg_password;Database=SurveySolutions&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -v <span style=color:#a31515>&#34;hq_data:/app/AppData&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -v <span style=color:#a31515>&#34;data_protection:/root/.aspnet/DataProtection-Keys&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    surveysolutions/surveysolutions:latest
</code></pre></div><h4 id=using-local-folder>Using local folder</h4><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker run -p 80:80 --name hq <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -e <span style=color:#a31515>&#34;HQ_Headquarters__TenantName=hq&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -e <span style=color:#a31515>&#34;HQ_Headquarters__BaseUrl=http://localhost&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -e <span style=color:#a31515>&#34;HQ_ConnectionStrings__DefaultConnection=Server=db;Port=5432;User Id=postgres;Password=pg_password;Database=SurveySolutions&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -v <span style=color:#a31515>&#34;./data/app:/app/AppData&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -v <span style=color:#a31515>&#34;./data/protection:/root/.aspnet/DataProtection-Keys&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    surveysolutions/surveysolutions:latest
</code></pre></div><h3 id=ssl>SSL</h3><p>It is possible to run Survey Solutions with SSL in Docker. You can refer to Microsoft documentation on how to run in docker with HTTPS - <a href="https://docs.microsoft.com/en-us/aspnet/core/security/docker-compose-https?view=aspnetcore-3.1">https://docs.microsoft.com/en-us/aspnet/core/security/docker-compose-https?view=aspnetcore-3.1</a></p><p>Following configuration can be provided to Survey Solutions with <a href=https://docs.docker.com/engine/reference/commandline/run/#set-environment-variables--e---env---env-file>enviroment variables</a></p><p>Environment variables:</p><ul><li><code>-e ASPNETCORE_URLS=https://+:443;http://+:80</code></li><li><code>-e ASPNETCORE_Kestrel__Certificates__Default__Path=/ssl/cert.pfx</code> - path to SSL certificate inside docker</li><li><code>-e ASPNETCORE_Kestrel__Certificates__Default__Password</code> - password for PFX certificate</li></ul><p>Volume:</p><ul><li><code>-v ./path/to/ssl.pfx:/ssl/cert.pfx</code></li></ul><p>Ports</p><ul><li><code>-p 80:80</code></li><li><code>-p 443:443</code></li></ul><h4 id=full-example-with-ssl>Full example with SSL</h4><p>Assume that certificate is located in folder <code>/srv/hq/.ssl/cert.pfx</code> with password <code>password</code></p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker run -p 80:80 -p 443:443 --name hq <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -e <span style=color:#a31515>&#34;HQ_Headquarters__TenantName=hq&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -e <span style=color:#a31515>&#34;HQ_Headquarters__BaseUrl=https://mysurvey.example.com&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -e <span style=color:#a31515>&#34;HQ_ConnectionStrings__DefaultConnection=Server=192.168.192.72;Port=5432;User Id=postgres;Password=Qwerty1234;Database=SurveySolutions&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -e <span style=color:#a31515>&#34;ASPNETCORE_URLS=https://+:443;http://+:80&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -e <span style=color:#a31515>&#34;ASPNETCORE_Kestrel__Certificates__Default__Path=/ssl/cert.pfx&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -e <span style=color:#a31515>&#34;ASPNETCORE_Kestrel__Certificates__Default__Password=password&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -v <span style=color:#a31515>&#34;/srv/hq/hq_data/app:/app/AppData&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -v <span style=color:#a31515>&#34;/srv/hq/.ssl/cert.pfx:/ssl/cert.pfx&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    -v <span style=color:#a31515>&#34;/srv/hq/protection:/root/.aspnet/DataProtection-Keys&#34;</span> <span style=color:#a31515>\
</span><span style=color:#a31515></span>    surveysolutions/surveysolutions:latest
</code></pre></div><h3 id=docker-compose>Docker-compose</h3><p>Typing all those docker run parameters can be quite error prone. We provide a template for sample repository for running Survey Solutions with <code>docker-compose</code> in this repository <a href=https://github.com/surveysolutions/docker-compose>https://github.com/surveysolutions/docker-compose</a>.</p><blockquote><p>While running Postgres instance in docker is viable solution, we strongly recommend to run PostgreSQL in separate server or use &ldquo;managed&rdquo; solutions provided by cloud providers(i.e. Amazon RDS, Azure Database for PostgreSQL, Google Cloud SQL, etc&mldr;)</p></blockquote><h3 id=required-configuration-settings>Required configuration settings</h3><p>There is several required configuration that You should be aware of to run in Docker.</p><ul><li><code>HQ_Headquarters__TenantName</code> is required in Survey Solution as of version <code>v20.10</code>. There is no visual features linked to this configuration. Will be dropped in future versions.</li><li><code>HQ_ConnectionStrings__DefaultConnection</code> - connection string to Postgres database instance</li><li><code>HQ_Headquarters__BaseUrl</code> - Base URL for HQ. Used in Web mode and emails.</li><li><code>HQ_Logging__LogsLocation: /app/AppData/logs</code> can be configured to specify logs locations</li><li><code>Export_ExportSettings__DirectoryPath: /app/AppData/Export</code> to preserve data export artifacts</li></ul><h2 id=updating-survey-solutions>Updating Survey Solutions</h2><ul><li>Stop docker container with Survey Solutions</li><li>Run <code>docker pull surveysolutions/surveysolutions</code></li><li>Restart docker container</li></ul></div></article></div></main><footer class="footer pt-3 pb-1 px-sm-3 px-lg-0"><div class="container copyright"><div class=float-left>&#169; 2016-2021 The World Bank Group.<br>All rights Reserved. <a href=https://www.worldbank.org/en/about/legal _target=blank>Legal</a><br><a class=text-primary href=/about/ _target=blank><b class=text-primary>About the team</b></a>
<a class=text-primary href=http://www.capterra.com/p/153927/Survey-Solutions/ target=_blank>Testimonials</a></div></div></footer><script src=https://code.jquery.com/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js></script><script src=https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js></script><script src=/js/asearch.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.min.js></script><script>$(document).on('click','[data-toggle="lightbox"]',function(a){a.preventDefault(),$(this).ekkoLightbox({alwaysShowClose:!0})})</script></body></html>